<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalogo Moduli - RSA Manager</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="dashboard">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <a href="/dashboard" class="header-logo">
                    <span>üè•</span>
                    <h2>RSA Manager</h2>
                </a>
            </div>
            
            <div class="header-right">
                <div class="user-menu">
                    <button class="user-button" onclick="toggleUserMenu()">
                        <div class="user-avatar" id="userAvatar">--</div>
                        <div class="user-info">
                            <span class="user-name" id="userName">...</span>
                            <span class="user-role" id="userRole">...</span>
                        </div>
                    </button>
                    
                    <div class="user-dropdown" id="userDropdown">
                        <a href="/profile">
                            <span>üë§</span>
                            <span>Il mio profilo</span>
                        </a>
                        <hr>
                        <button onclick="handleLogout()" class="danger">
                            <span>üö™</span>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="/dashboard">Dashboard</a> / Catalogo Moduli
        </div>
        
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">üìÑ Catalogo Moduli Clinici</h1>
            <button class="btn btn-primary" onclick="showCreateModal()">
                + Nuovo Modulo
            </button>
        </div>
        
        <!-- Alert -->
        <div id="alert" class="alert alert-error" style="display: none; margin-bottom: 20px;"></div>
        
        <!-- Info Box -->
        <div class="info-box" style="margin-bottom: 20px;">
            <strong>‚ÑπÔ∏è Catalogo Moduli</strong>
            Questo √® il catalogo dei moduli clinici disponibili. Da qui puoi gestire quali moduli sono attivi 
            e disponibili per la compilazione. Per compilare i dati di un modulo, clicca sull'icona üëÅÔ∏è e poi 
            "Registra Modulo".
        </div>
        
        <!-- Barra Filtri -->
        <div class="filters-bar">
            <div class="filters-grid">
                <div class="filter-group" style="grid-column: 1 / -1;">
                    <label>Cerca modulo</label>
                    <input 
                        type="text" 
                        id="searchQuery" 
                        placeholder="Cerca per codice o nome..."
                        onkeypress="if(event.key === 'Enter') applyFilters()"
                    >
                </div>
                
                <div class="filter-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="filterActiveOnly">
                        <span>Solo moduli attivi</span>
                    </label>
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="btn btn-sm btn-secondary" onclick="resetFilters()">
                    Reset
                </button>
                <button class="btn btn-sm btn-primary" onclick="applyFilters()">
                    üîç Cerca
                </button>
            </div>
        </div>
        
        <!-- Tabella -->
        <div class="table-container">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Codice</th>
                            <th>Nome</th>
                            <th>Versione Schema</th>
                            <th>Stato</th>
                            <th>Ultimo Aggiornamento</th>
                            <th>Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="modulesTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div class="loading">Caricamento...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Paginazione -->
            <div class="pagination">
                <span class="pagination-info" id="paginationInfo">-</span>
                <div class="pagination-buttons">
                    <button class="btn btn-sm btn-secondary" id="prevPage" onclick="previousPage()">
                        ‚Üê Precedente
                    </button>
                    <button class="btn btn-sm btn-secondary" id="nextPage" onclick="nextPage()">
                        Successiva ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Modal Creazione -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nuovo Modulo</h3>
                <button class="modal-close" onclick="closeCreateModal()">√ó</button>
            </div>
            
            <form id="createForm" onsubmit="createModule(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="moduleCode">Codice Modulo *</label>
                        <input 
                            type="text" 
                            id="moduleCode" 
                            required
                            maxlength="10"
                            placeholder="Es. ROG26/1.4"
                            style="text-transform: uppercase;"
                        >
                        <small style="color: #6b7280; font-size: 12px;">
                            Massimo 10 caratteri, verr√† convertito in maiuscolo
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="moduleName">Nome Modulo</label>
                        <input 
                            type="text" 
                            id="moduleName"
                            placeholder="Es. Valutazione Infermieristica"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="moduleVersion">Versione Schema Corrente *</label>
                        <input 
                            type="number" 
                            id="moduleVersion" 
                            required
                            min="1"
                            value="1"
                        >
                        <small style="color: #6b7280; font-size: 12px;">
                            La versione dello schema dei dati per questo modulo (deve essere > 0)
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="moduleActive" checked>
                            <span>Modulo attivo (disponibile per l'uso)</span>
                        </label>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">
                        Annulla
                    </button>
                    <button type="submit" class="btn btn-primary" id="createSubmitBtn">
                        <span>Crea Modulo</span>
                        <span class="spinner" style="display: none;"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Dettaglio -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dettaglio Modulo</h3>
                <button class="modal-close" onclick="closeDetailModal()">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Codice Modulo</span>
                        <span class="detail-value" id="detailCode" 
                              style="font-family: monospace; font-size: 18px; font-weight: 600; color: var(--primary);">
                            -
                        </span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Nome</span>
                        <span class="detail-value" id="detailName">-</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Versione Schema</span>
                        <span class="detail-value" id="detailVersion">-</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Stato</span>
                        <span class="detail-value" id="detailActive">-</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Ultimo Aggiornamento</span>
                        <span class="detail-value" id="detailUpdated">-</span>
                    </div>
                </div>
                
                <!-- Azione Registra Modulo -->
                <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--gray-200);">
                    <button class="btn btn-primary" id="registerModuleBtn" style="width: 100%;">
                        üìù Registra Modulo (Compila Dati)
                    </button>
                    <p style="font-size: 12px; color: #6b7280; text-align: center; margin-top: 8px;">
                        Funzionalit√† da implementare nella prossima fase
                    </p>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDetailModal()">
                    Chiudi
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal Modifica -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Modifica Modulo</h3>
                <button class="modal-close" onclick="closeEditModal()">√ó</button>
            </div>
            
            <form id="editForm" onsubmit="editModule(event)">
                <div class="modal-body">
                    <input type="hidden" id="editModuleId">
                    
                    <div class="form-group">
                        <label for="editModuleCode">Codice Modulo</label>
                        <input 
                            type="text" 
                            id="editModuleCode" 
                            disabled
                            style="background: var(--gray-100); cursor: not-allowed;"
                        >
                        <small style="color: #6b7280; font-size: 12px;">
                            Il codice non pu√≤ essere modificato
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="editModuleName">Nome Modulo</label>
                        <input 
                            type="text" 
                            id="editModuleName"
                            placeholder="Es. Valutazione Infermieristica"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="editModuleVersion">Versione Schema Corrente *</label>
                        <input 
                            type="number" 
                            id="editModuleVersion" 
                            required
                            min="1"
                        >
                        <small style="color: #6b7280; font-size: 12px;">
                            Aggiorna la versione se hai modificato lo schema dei dati
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="editModuleActive">
                            <span>Modulo attivo (disponibile per l'uso)</span>
                        </label>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                        Annulla
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Salva Modifiche
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/moduli.js"></script>
</body>
</html>